<div class="modern-auth-container">
  <!-- Language Switcher -->
  <button class="language-switcher" (click)="toggleLanguage()">
    <i class="bi bi-translate"></i>
    <span>{{ currentLang === 'en' ? 'العربية' : 'English' }}</span>
  </button>

  <!-- Background Elements -->
  <div class="auth-background">
    <div class="gradient-orb orb-1"></div>
    <div class="gradient-orb orb-2"></div>
    <div class="gradient-orb orb-3"></div>
  </div>

  <div class="auth-content">
    <div class="container">
      <div class="row min-vh-100 align-items-center justify-content-center">
        <!-- Left Side - Branding (Hidden on mobile) -->
        <div class="col-lg-6 d-none d-lg-block">
          <div class="branding-section fade-in">
            <div class="brand-logo-large">
              <div class="logo-circle">
                <i class="bi bi-person-plus"></i>
              </div>
            </div>
            <h1 class="brand-title">{{ 'auth.welcomeBack' | translate }}</h1>
            <p class="brand-description">{{ 'auth.loginSubtitle' | translate }}</p>
            
            <div class="features-list">
              <div class="feature-item">
                <i class="bi bi-check-circle-fill"></i>
                <span>{{ 'auth.quickProcess' | translate }}</span>
              </div>
              <div class="feature-item">
                <i class="bi bi-check-circle-fill"></i>
                <span>{{ 'auth.secureOtp' | translate }}</span>
              </div>
              <div class="feature-item">
                <i class="bi bi-check-circle-fill"></i>
                <span>{{ 'auth.completeKyc' | translate }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Side - Start Form -->
        <div class="col-lg-6 col-md-8 col-sm-10">
          <div class="login-card fade-in-up">
            <!-- Mobile Logo -->
            <div class="mobile-logo d-lg-none">
              <div class="logo-circle-small">
                <i class="bi bi-person-plus"></i>
              </div>
            </div>

            <!-- Card Header -->
            <div class="card-header-custom">
              <h2 class="login-title">{{ otpSent ? ('auth.verifyOtpTitle' | translate) : ('auth.welcomeBack' | translate) }}</h2>
              <p class="login-subtitle">{{ otpSent ? ('auth.verifyOtpSubtitle' | translate) : ('auth.loginSubtitle' | translate) }}</p>
            </div>

            <!-- Error Alert -->
            <div *ngIf="error" class="alert alert-danger alert-modern alert-dismissible">
              <div class="alert-content">
                <i class="bi bi-exclamation-triangle-fill"></i>
                <span>{{ error }}</span>
              </div>
              <button type="button" class="alert-close" (click)="error = null">
                <i class="bi bi-x-lg"></i>
              </button>
              <div class="alert-progress"></div>
            </div>

            <!-- Step 1: Start Form -->
            <form [formGroup]="startForm" (ngSubmit)="onSubmitStart()" class="login-form" *ngIf="!otpSent">
              <!-- ID Number -->
              <div class="form-group-modern">
                <label class="form-label-custom">
                  <i class="bi bi-card-text"></i>
                  {{ 'auth.idNumber' | translate }}
                </label>
                <div class="input-wrapper">
                  <input
                    type="text"
                    class="form-control-custom"
                    formControlName="idNumber"
                    placeholder="1234567890"
                    maxlength="10"
                    [class.error]="startForm.get('idNumber')?.invalid && startForm.get('idNumber')?.touched"
                  />
                  <i class="input-icon bi bi-card-text"></i>
                </div>
                <div class="error-message" *ngIf="startForm.get('idNumber')?.invalid && startForm.get('idNumber')?.touched">
                  <i class="bi bi-exclamation-circle"></i>
                  {{ 'kyc.validation.idInvalid' | translate }}
                </div>
              </div>

              <!-- Mobile Number -->
              <div class="form-group-modern">
                <label class="form-label-custom">
                  <i class="bi bi-phone"></i>
                  {{ 'auth.mobile' | translate }}
                </label>
                <div class="input-wrapper">
                  <input
                    type="tel"
                    class="form-control-custom"
                    formControlName="mobile"
                    placeholder="05xxxxxxxx"
                    maxlength="10"
                    [class.error]="startForm.get('mobile')?.invalid && startForm.get('mobile')?.touched"
                  />
                  <i class="input-icon bi bi-phone-fill"></i>
                </div>
                <div class="error-message" *ngIf="startForm.get('mobile')?.invalid && startForm.get('mobile')?.touched">
                  <i class="bi bi-exclamation-circle"></i>
                  {{ 'kyc.validation.mobileInvalid' | translate }}
                </div>
              </div>

              <!-- Submit Button -->
              <button
                type="submit"
                class="btn-submit-modern"
                [disabled]="startForm.invalid || loading"
                [class.loading]="loading"
              >
                <span class="btn-content" *ngIf="!loading">
                  <i class="bi bi-box-arrow-in-right"></i>
                  <span>{{ 'auth.login' | translate }}</span>
                </span>
                <span class="btn-content" *ngIf="loading">
                  <span class="spinner"></span>
                  <span>{{ 'auth.sendingOtp' | translate }}</span>
                </span>
              </button>
            </form>

            <!-- Step 2: OTP Form -->
            <form [formGroup]="otpForm" (ngSubmit)="onSubmitOtp()" class="login-form" *ngIf="otpSent">
              <!-- Success Info -->
              <div class="alert alert-success alert-modern">
                <i class="bi bi-check-circle-fill"></i>
                <span>{{ 'auth.otpSentTo' | translate }} {{ mobile }}</span>
              </div>

              <!-- OTP Input -->
              <div class="form-group-modern">
                <label class="form-label-custom">
                  <i class="bi bi-shield-lock"></i>
                  {{ 'auth.otp' | translate }}
                </label>
                <div class="input-wrapper">
                  <input
                    type="text"
                    class="form-control-custom otp-input"
                    formControlName="otp"
                    placeholder="• • • •"
                    maxlength="4"
                    [class.error]="otpForm.get('otp')?.invalid && otpForm.get('otp')?.touched"
                  />
                  <i class="input-icon bi bi-shield-lock-fill"></i>
                </div>
                <div class="error-message" *ngIf="otpForm.get('otp')?.invalid && otpForm.get('otp')?.touched">
                  <i class="bi bi-exclamation-circle"></i>
                  {{ 'kyc.validation.otpInvalid' | translate }}
                </div>
              </div>

              <!-- Submit Button -->
              <button
                type="submit"
                class="btn-submit-modern"
                [disabled]="otpForm.invalid || loading"
                [class.loading]="loading"
              >
                <span class="btn-content" *ngIf="!loading">
                  <i class="bi bi-box-arrow-in-right"></i>
                  <span>{{ 'auth.verifyOtp' | translate }}</span>
                </span>
                <span class="btn-content" *ngIf="loading">
                  <span class="spinner"></span>
                  <span>{{ 'auth.verifying' | translate }}</span>
                </span>
              </button>

              <!-- Back Button -->
              <button type="button" class="btn-back-modern" (click)="goBack()">
                <i class="bi bi-arrow-left"></i>
                <span>{{ 'auth.changeMobile' | translate }}</span>
              </button>
            </form>

            <!-- Footer -->
            <div class="card-footer-custom">
              <p>
                <i class="bi bi-shield-check"></i>
                {{ 'auth.dataProtected' | translate }}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Nafath Dialog -->
<app-nafath-dialog
  *ngIf="showNafathDialog"
  [transactionId]="nafathTransactionId"
  [requestId]="nafathRequestId"
  (completed)="onNafathCompleted($event)"
  (cancelled)="onNafathCancelled()"
  (failed)="onNafathFailed($event)">
</app-nafath-dialog>
